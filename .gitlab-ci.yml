image: python:3.13-slim

stages:
  - lint
  - test
  - build

before_script:
  - pip install uv
  - export PYTHONPATH="$PYTHONPATH:./src"

ğŸ¶ ruff:
  stage: lint
  script: uv run ruff check src/

ğŸ° mypy:
  stage: lint
  script: uv run mypy src/

ğŸ§ª pytest:
  stage: test
  needs:
    - ğŸ¶ ruff
    - ğŸ° mypy
  script:
    - uv run pytest --cov=src --cov-report=json
  after_script:
    - apt-get update
    - apt-get install -y --no-install-recommends curl
    - curl -Os https://cli.codecov.io/latest/linux/codecov
    - chmod +x codecov
    - ./codecov upload-process -t $CODECOV_TOKEN --env CI_SERVICE=gitlab

ğŸš€ pages:
  stage: build
  only:
    - main
  needs:
    - ğŸ§ª pytest
  pages: true
  script:
    - cd src
    - uv run pelican content -s core/settings.py -o ../public
