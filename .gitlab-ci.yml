image: python:3.13-slim

stages:
  - lint
  - test
  - build

before_script:
  - pip install uv
  - export PYTHONPATH="$PYTHONPATH:./src"

🐶 ruff:
  stage: lint
  script: uv run ruff check src/

🍰 mypy:
  stage: lint
  script: uv run mypy src/

🧪 pytest:
  stage: test
  needs:
    - 🐶 ruff
    - 🍰 mypy
  script:
    - uv run pytest --cov=src --cov-report=json
  after_script:
    - curl -Os https://cli.codecov.io/latest/linux/codecov
    - chmod +x codecov
    - ./codecov upload-process -t $CODECOV_TOKEN

🚀 pages:
  stage: build
  only:
    - main
  needs:
    - 🧪 pytest
  pages: true
  script:
    - cd src
    - uv run pelican content -s core/settings.py -o ../public
